---
import path from "node:path";
import { fileURLToPath } from "url";
import { $ } from "bun";
import { micromark } from "micromark";
const { filePath } = Astro.props;

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

/* @vite-ignore */
const { rescript_tools_exe } = await import(
    path.join(__dirname, "../../node_modules/rescript/cli/common/bins.js")
);

console.log(rescript_tools_exe);
const doc = await $`${rescript_tools_exe} doc ${filePath}`.json();

const types = doc.items
    .filter((d) => d.kind === "type")
    .sort((a, b) => a.name.localeCompare(b.name))
    .map((type) => {
        const documentation =
            type.docstrings && micromark(type.docstrings.join("\n"));
        return {
            name: type.name,
            documentation,
            signature: type.signature,
            detail: type.detail,
        };
    });
---

<pre>{JSON.stringify(types, null, 2)}</pre>
