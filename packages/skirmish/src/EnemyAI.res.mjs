// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Ember$Skirmish from "./Moves/Ember.res.mjs";
import * as Pokemon$Skirmish from "./Pokemon.res.mjs";
import * as Primitive_object from "@rescript/runtime/lib/es6/Primitive_object.js";
import * as GameContext$Skirmish from "./GameContext.res.mjs";

function directionToPlayer(enemy, player) {
  let ex = enemy.pos.x;
  let px = player.pos.x;
  let distance = px - ex;
  if (distance > 1) {
    return GameContext$Skirmish.k.Vec2.RIGHT;
  } else if (distance < - 1) {
    return GameContext$Skirmish.k.Vec2.LEFT;
  } else {
    return GameContext$Skirmish.k.Vec2.ZERO;
  }
}

function addEnemyAI(player) {
  let update = function () {
    let self = this ;
    let t = self.state;
    if (typeof t === "object") {
      if (GameContext$Skirmish.k.time() > t._0) {
        self.state = "Thinking";
        return;
      } else {
        return;
      }
    }
    switch (t) {
      case "Thinking" :
        let direction = directionToPlayer(self, player);
        if (Primitive_object.notequal(direction, GameContext$Skirmish.k.Vec2.ZERO)) {
          self.state = "Move";
        } else {
          self.state = "Attack";
        }
        return;
      case "Move" :
        let direction$1 = directionToPlayer(self, player);
        if (Primitive_object.equal(direction$1, GameContext$Skirmish.k.Vec2.ZERO)) {
          self.state = "Attack";
        } else {
          self.move(direction$1.scale(50));
        }
        return;
      case "Attack" :
        Ember$Skirmish.cast(self);
        let t$1 = GameContext$Skirmish.k.time() + 2.0;
        self.state = {
          TAG: "CoolDown",
          _0: t$1
        };
        return;
    }
  };
  return {
    id: "enemy-ai",
    update: update
  };
}

function make(pokemonId, level, player) {
  let gameObj = Pokemon$Skirmish.make(pokemonId, level, false);
  gameObj.state = "Thinking";
  gameObj.use(addEnemyAI(player));
  return gameObj;
}

export {
  directionToPlayer,
  addEnemyAI,
  make,
}
/* Ember-Skirmish Not a pure module */
