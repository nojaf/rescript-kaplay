// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Pkmn$Skirmish from "./Pkmn.res.mjs";
import * as GameContext$Skirmish from "./GameContext.res.mjs";

function make() {
  return {
    wasDown: false
  };
}

function isNewPress(state, isDown) {
  let isNew = isDown && !state.wasDown;
  state.wasDown = isDown;
  return isNew;
}

let KeyEdge = {
  make: make,
  isNewPress: isNewPress
};

function make$1(pokemon) {
  Pkmn$Skirmish.assignPlayer(pokemon);
  let jKey = {
    wasDown: false
  };
  let kKey = {
    wasDown: false
  };
  let lKey = {
    wasDown: false
  };
  let semicolonKey = {
    wasDown: false
  };
  GameContext$Skirmish.k.onUpdate(() => {
    let isNewJPress = isNewPress(jKey, GameContext$Skirmish.k.isKeyDown("j"));
    let isNewKPress = isNewPress(kKey, GameContext$Skirmish.k.isKeyDown("k"));
    let isNewLPress = isNewPress(lKey, GameContext$Skirmish.k.isKeyDown("l"));
    let isNewSemicolonPress = isNewPress(semicolonKey, GameContext$Skirmish.k.isKeyDown(";"));
    let isUpPressed = GameContext$Skirmish.k.isKeyDown("up") || GameContext$Skirmish.k.isKeyDown("w");
    let isDownPressed = GameContext$Skirmish.k.isKeyDown("down") || GameContext$Skirmish.k.isKeyDown("s");
    let isLeftPressed = GameContext$Skirmish.k.isKeyDown("left") || GameContext$Skirmish.k.isKeyDown("a");
    let isRightPressed = GameContext$Skirmish.k.isKeyDown("right") || GameContext$Skirmish.k.isKeyDown("d");
    let movementPressed = isUpPressed || isDownPressed || isLeftPressed || isRightPressed;
    if (isNewJPress) {
      Pkmn$Skirmish.tryCastMove(pokemon, 0);
    } else if (isNewKPress) {
      Pkmn$Skirmish.tryCastMove(pokemon, 1);
    } else if (isNewLPress) {
      Pkmn$Skirmish.tryCastMove(pokemon, 2);
    } else if (isNewSemicolonPress) {
      Pkmn$Skirmish.tryCastMove(pokemon, 3);
    } else if (isUpPressed) {
      if (pokemon.facing !== true) {
        Pkmn$Skirmish.dispatch(pokemon, {
          TAG: "FacingChanged",
          _0: true
        });
      }
    } else if (isDownPressed) {
      if (pokemon.facing !== false) {
        Pkmn$Skirmish.dispatch(pokemon, {
          TAG: "FacingChanged",
          _0: false
        });
      }
    } else if (isLeftPressed) {
      pokemon.direction = GameContext$Skirmish.k.Vec2.LEFT;
    } else if (isRightPressed) {
      pokemon.direction = GameContext$Skirmish.k.Vec2.RIGHT;
    }
    if (pokemon.mobility === true && movementPressed) {
      pokemon.move(pokemon.direction.scale(Pkmn$Skirmish.movementSpeed));
      return;
    }
  });
}

export {
  KeyEdge,
  make$1 as make,
}
/* Pkmn-Skirmish Not a pure module */
