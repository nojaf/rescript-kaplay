// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Belt_Array from "@rescript/runtime/lib/es6/Belt_Array.js";
import * as Pos$Kaplay from "@nojaf/rescript-kaplay/src/Components/Pos.res.mjs";
import * as Area$Kaplay from "@nojaf/rescript-kaplay/src/Components/Area.res.mjs";
import * as Anchor$Kaplay from "@nojaf/rescript-kaplay/src/Components/Anchor.res.mjs";
import * as Health$Kaplay from "@nojaf/rescript-kaplay/src/Components/Health.res.mjs";
import * as Shader$Kaplay from "@nojaf/rescript-kaplay/src/Components/Shader.res.mjs";
import * as Sprite$Kaplay from "@nojaf/rescript-kaplay/src/Components/Sprite.res.mjs";
import * as Animate$Kaplay from "@nojaf/rescript-kaplay/src/Components/Animate.res.mjs";
import * as Opacity$Kaplay from "@nojaf/rescript-kaplay/src/Components/Opacity.res.mjs";
import * as GameObjRaw$Kaplay from "@nojaf/rescript-kaplay/src/Components/GameObjRaw.res.mjs";
import * as GameContext$Skirmish from "./GameContext.res.mjs";

GameObjRaw$Kaplay.Comp({});

Pos$Kaplay.Comp({});

Sprite$Kaplay.Comp({});

Area$Kaplay.Comp({});

Health$Kaplay.Comp({});

Anchor$Kaplay.Comp({});

Shader$Kaplay.Comp({});

Opacity$Kaplay.Comp({});

Animate$Kaplay.Comp({});

let tag = "pokemon";

function frontSpriteName(id) {
  return "pokemon-" + id.toString() + "-front";
}

function backSpriteName(id) {
  return "pokemon-" + id.toString() + "-back";
}

function frontSpriteUrl(id) {
  return `/sprites/` + id.toString() + `-front.png`;
}

function backSpriteUrl(id) {
  return `/sprites/` + id.toString() + `-back.png`;
}

function load(id) {
  GameContext$Skirmish.k.loadSprite(frontSpriteName(id), frontSpriteUrl(id), {
    singular: true
  });
  GameContext$Skirmish.k.loadSprite(backSpriteName(id), backSpriteUrl(id), {
    singular: true
  });
}

function getHealthPercentage(pokemon) {
  let currentHp = pokemon.hp;
  let maxHp = pokemon.maxHP;
  return currentHp / maxHp * 100;
}

function make(id, team) {
  let gameObj = GameContext$Skirmish.k.add(Belt_Array.concatMany([
    team === "Player" ? [
        {
          direction: GameContext$Skirmish.k.Vec2.UP
        },
        GameContext$Skirmish.k.pos(GameContext$Skirmish.k.center().x, GameContext$Skirmish.k.height() * 0.8),
        GameContext$Skirmish.k.sprite(backSpriteName(id))
      ] : [
        {
          direction: GameContext$Skirmish.k.Vec2.DOWN
        },
        GameContext$Skirmish.k.pos(GameContext$Skirmish.k.center().x, GameContext$Skirmish.k.height() * 0.2),
        GameContext$Skirmish.k.sprite(frontSpriteName(id))
      ],
    [
      GameContext$Skirmish.k.area(),
      GameContext$Skirmish.k.health(20, 20),
      GameContext$Skirmish.k.anchor("center"),
      GameContext$Skirmish.k.opacity(1),
      GameContext$Skirmish.k.animate(),
      tag
    ]
  ]));
  if (team === "Player") {
    GameContext$Skirmish.k.onUpdate(() => {
      let leftDown = GameContext$Skirmish.k.isKeyDown("left") || GameContext$Skirmish.k.isKeyDown("a");
      let rightDown = GameContext$Skirmish.k.isKeyDown("right") || GameContext$Skirmish.k.isKeyDown("d");
      let upDown = GameContext$Skirmish.k.isKeyDown("up") || GameContext$Skirmish.k.isKeyDown("w");
      let downDown = GameContext$Skirmish.k.isKeyDown("down") || GameContext$Skirmish.k.isKeyDown("s");
      if (leftDown || rightDown || upDown || downDown) {
        if (upDown && !downDown) {
          gameObj.direction = GameContext$Skirmish.k.Vec2.UP;
          gameObj.sprite = backSpriteName(id);
        } else if (downDown && !upDown) {
          gameObj.direction = GameContext$Skirmish.k.Vec2.DOWN;
          gameObj.sprite = frontSpriteName(id);
        } else if (leftDown && !rightDown) {
          gameObj.direction = GameContext$Skirmish.k.Vec2.LEFT;
        } else if (rightDown && !leftDown) {
          gameObj.direction = GameContext$Skirmish.k.Vec2.RIGHT;
        }
        gameObj.move(gameObj.direction.scale(200));
        return;
      }
    });
    GameContext$Skirmish.k.onKeyRelease(key => {
      if (key !== "f1" && key !== "shift" && key !== "f2" && key !== "down" && key !== "f3" && key !== "up" && key !== "f4" && key !== "right" && key !== "f5" && key !== "left" && key !== "f6" && key !== " " && key !== "f7" && key !== "space" && key !== "f8" && key !== "meta" && key !== "f9" && key !== "alt" && key !== "f10" && key !== "control" && key !== "f11" && key !== "tab" && key !== "f12" && key !== "enter" && key !== "`" && key !== "backspace" && key !== "1" && key !== "escape" && key !== "2" && key !== "/" && key !== "3" && key !== "." && key !== "4" && key !== "," && key !== "5" && key !== "m" && key !== "6" && key !== "n" && key !== "7" && key !== "b" && key !== "8" && key !== "v" && key !== "9" && key !== "c" && key !== "0" && key !== "x" && key !== "-" && key !== "z" && key !== "+" && key !== "'" && key !== "=" && key !== ";" && key !== "q" && key !== "l" && key !== "w" && key !== "k" && key !== "e" && key !== "j" && key !== "r" && key !== "h" && key !== "t" && key !== "g" && key !== "y" && key !== "f" && key !== "u" && key !== "d" && key !== "i" && key !== "s" && key !== "o" && key !== "a" && key !== "p" && key !== "\\" && key !== "[" && key !== "]") {
        return;
      }
      if (key !== "space") {
        return;
      }
      gameObj.trigger("Thundershock", gameObj);
    });
  }
  gameObj.onHurt(deltaHp => {
    console.log("I hurt myself today", deltaHp);
    gameObj.unanimate("opacity");
    let animation = gameObj.animation;
    animation.seek(0);
    gameObj.animate("opacity", [
      1,
      0.5,
      1,
      0.75,
      1
    ], {
      duration: 0.4,
      loops: 1
    });
  });
  return gameObj;
}

let movementSpeed = 200;

export {
  tag,
  frontSpriteName,
  backSpriteName,
  frontSpriteUrl,
  backSpriteUrl,
  load,
  movementSpeed,
  getHealthPercentage,
  make,
}
/*  Not a pure module */
